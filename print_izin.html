<!DOCTYPE html>
<html>

<head>
    <title>Cetak Surat Izin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            width: 58mm;
            color: black;
        }

        @media print {
            @page {
                margin: 0;
            }

            body {
                margin: 5px;
            }

            .no-print {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-white">
    <div id="loading" class="text-center py-4">Memuat Data...</div>
    <div id="content" class="hidden">
        <div class="text-center font-bold text-sm uppercase mb-2">PPS SHIROTHUL FUQOHA</div>
        <div class="text-center text-xs mb-2">Kartu Izin Keluar</div>
        <div class="border-b border-dashed border-black my-2"></div>

        <div class="flex justify-between text-xs mb-1">
            <span>Tgl:</span>
            <span id="p-date"></span>
        </div>
        <div class="flex justify-between text-xs mb-1">
            <span>Jam:</span>
            <span id="p-time"></span>
        </div>
        <div class="flex justify-between text-xs mb-1">
            <span>Oleh:</span>
            <span id="p-petugas"></span>
        </div>

        <div class="border-b border-dashed border-black my-2"></div>

        <div class="font-bold text-sm mb-1" id="p-nama"></div>
        <div class="text-xs mb-2" id="p-detail"></div>

        <div class="border-b border-dashed border-black my-2"></div>

        <div class="font-bold text-xs mb-1">TUJUAN:</div>
        <div class="text-xs mb-2" id="p-tujuan"></div>

        <div class="border-b border-dashed border-black my-2"></div>
        <div class="text-center font-bold text-xs">WAJIB KEMBALI SEBELUM:</div>
        <div class="text-center font-bold text-base my-2" id="p-kembali"></div>
        <div class="border-b border-dashed border-black my-2"></div>

        <div class="text-center text-[10px] mt-3">
            Simpan struk ini.<br>Serahkan ke petugas saat kembali.
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            document.body.innerText = "ID Tidak Valid";
        } else {
            apiCall(`perizinan.php?action=read&id=${id}`).then(res => {
                if (res) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').classList.remove('hidden');

                    const d = new Date(res.waktu_keluar);
                    const k = new Date(res.rencana_kembali);

                    document.getElementById('p-date').innerText = d.toLocaleDateString('id-ID');
                    document.getElementById('p-time').innerText = d.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('p-petugas').innerText = (res.petugas_nama || 'Admin').split(' ')[0]; // First name only

                    document.getElementById('p-nama').innerText = res.nama;
                    document.getElementById('p-detail').innerText = `${res.kelas} - ${res.asrama}`;
                    document.getElementById('p-tujuan').innerText = res.tujuan_izin;

                    document.getElementById('p-kembali').innerText = k.toLocaleString('id-ID', { day: 'numeric', month: 'numeric', hour: '2-digit', minute: '2-digit' });

                    setTimeout(() => window.print(), 500);
                } else {
                    document.body.innerText = "Data tidak ditemukan";
                }
            });
        }
    </script>
</body>

</html>